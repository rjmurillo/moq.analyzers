# Moq1502: Protected members should use Protected() setup

| Item     | Value   |
| -------- | ------- |
| Enabled  | True    |
| Severity | Warning |
| CodeFix  | False   |
---

When mocking protected members in Moq, you should use the `Protected()` method instead of accessing protected members directly in setup expressions. Direct access to protected members in lambda expressions will not work as expected because the lambda is compiled to a different context.

## Examples of patterns that are flagged by this analyzer

```csharp
public abstract class BaseClass
{
    protected virtual void ProtectedMethod() { }
    protected virtual string ProtectedProperty { get; set; }
}

var mock = new Mock<BaseClass>();

// These will be flagged by the analyzer
mock.Setup(x => x.ProtectedMethod()); // Moq1502: Protected members should use Protected() setup
mock.Setup(x => x.ProtectedProperty).Returns("value"); // Moq1502: Protected members should use Protected() setup
```

## Solution

Use the `Protected()` method to set up protected members:

```csharp
public abstract class BaseClass
{
    protected virtual void ProtectedMethod() { }
    protected virtual string ProtectedProperty { get; set; }
}

var mock = new Mock<BaseClass>();

// Correct usage with Protected()
mock.Protected().Setup("ProtectedMethod");
mock.Protected().Setup<string>("ProtectedProperty").Returns("value");
```

## Suppress a warning

If you just want to suppress a single violation, add preprocessor directives to
your source file to disable and then re-enable the rule.

```csharp
#pragma warning disable Moq1502
mock.Setup(x => x.ProtectedMethod()); // Moq1502: Protected members should use Protected() setup
#pragma warning restore Moq1502
```

To disable the rule for a file, folder, or project, set its severity to `none`
in the
[configuration file](https://learn.microsoft.com/en-us/dotnet/fundamentals/code-analysis/configuration-files).

```ini
[*.{cs,vb}]
dotnet_diagnostic.Moq1502.severity = none
```

For more information, see
[How to suppress code analysis warnings](https://learn.microsoft.com/en-us/dotnet/fundamentals/code-analysis/suppress-warnings).
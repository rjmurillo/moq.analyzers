# Moq1800: Event handler signature mismatch

| Item     | Value   |
| -------- | ------- |
| Enabled  | True    |
| Severity | Warning |
| CodeFix  | True    |
---

When setting up event handlers with SetupAdd, SetupRemove, or Raise, the event handler type should match the event signature exactly. Mismatched handler types can lead to runtime errors or unexpected behavior.

## Examples of patterns that are flagged by this analyzer

```csharp
public interface IFoo
{
    event System.EventHandler<string> StringEvent;
    event System.EventHandler BasicEvent;
}

var mock = new Mock<IFoo>();

// Mismatched handler type - StringEvent expects EventHandler<string>, not EventHandler<int>
mock.SetupAdd(m => m.StringEvent += It.IsAny<System.EventHandler<int>>()); // Moq1800: Event handler signature mismatch

// Mismatched handler type - BasicEvent expects EventHandler, not EventHandler<string>
mock.SetupAdd(m => m.BasicEvent += It.IsAny<System.EventHandler<string>>()); // Moq1800: Event handler signature mismatch
```

## Solution

Ensure the event handler type matches the event signature exactly:

```csharp
public interface IFoo
{
    event System.EventHandler<string> StringEvent;
    event System.EventHandler BasicEvent;
}

var mock = new Mock<IFoo>();

// Correct - handler type matches event signature
mock.SetupAdd(m => m.StringEvent += It.IsAny<System.EventHandler<string>>());
mock.SetupRemove(m => m.StringEvent -= It.IsAny<System.EventHandler<string>>());

// Correct - handler type matches event signature
mock.SetupAdd(m => m.BasicEvent += It.IsAny<System.EventHandler>());
mock.SetupRemove(m => m.BasicEvent -= It.IsAny<System.EventHandler>());

// Correct event raising
mock.Raise(m => m.StringEvent += null, "test data");
mock.Raise(m => m.BasicEvent += null, System.EventArgs.Empty);
```

## Suppress a warning

If you just want to suppress a single violation, add preprocessor directives to
your source file to disable and then re-enable the rule.

```csharp
#pragma warning disable Moq1800
mock.SetupAdd(m => m.StringEvent += It.IsAny<System.EventHandler<int>>()); // Moq1800: Event handler signature mismatch
#pragma warning restore Moq1800
```

To disable the rule for a file, folder, or project, set its severity to `none`
in the
[configuration file](https://learn.microsoft.com/en-us/dotnet/fundamentals/code-analysis/configuration-files).

```ini
[*.{cs,vb}]
dotnet_diagnostic.Moq1800.severity = none
```

For more information, see
[How to suppress code analysis warnings](https://learn.microsoft.com/en-us/dotnet/fundamentals/code-analysis/suppress-warnings).